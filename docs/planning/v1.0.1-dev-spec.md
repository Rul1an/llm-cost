# v1.0.1 Development Specification
## Codename: "FOCUS Hardening"
**Date:** 2025-12-12
**Status:** Implemented ✅

## 1. Scope (LOCKED)
v1.0.1 hardens determinism, Vantage compatibility, and parser safety.

### P0 (must ship) - [x] Done
1) **Vantage CSV contract**
   - [x] Header must be the first line (no `#` preambles/comments).
   - [x] CSV columns restricted to Vantage-supported FOCUS subset.
   - [x] Any non-subset data goes into `Tags`.

2) **Deterministic Tags JSON**
   - [x] System keys emitted in fixed order.
   - [x] User tags sorted lexicographically by key.
   - [x] **Reserved key policy**: user tags cannot override system keys (skipped).

3) **Cost formatting determinism**
   - [x] Avoid platform variance from floats.
   - [x] Use fixed-point representation (`pico-USD` in `i128`).
   - [x] Output `BilledCost` as decimal with fixed scale (12 digits).

4) **Test harness stability**
   - [x] Fix AnyWriter lifetime using custom vtable and heap-stable buckets.

### P1 (should ship) - [ ] Next
5) **CI flake hunting**
   - [ ] Add CI job that runs golden tests 20× with varying `--seed`.
   - [ ] Add determinism check: export 5× with `--test-date`.

6) **Minisign parser hardening**
   - [ ] Bound decoded Base64 record length before decode.
   - [ ] Cap trusted_comment length.

### P2 (nice to have) - [ ] Backlog
7) SLSA provenance + SBOM automation.

## 2. CSV Schema (Vantage-supported subset)
Implemented strictly:
```
ChargePeriodStart,ChargeCategory,BilledCost,ResourceId,ResourceType,RegionId,ServiceCategory,ServiceName,ConsumedQuantity,ConsumedUnit,Tags
```

## 3. Tags Contract
Implemented strictly with System Keys first + User Keys Sorted.
